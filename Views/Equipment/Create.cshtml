@model AquaHub.MVC.Models.Equipment
@{
    ViewData["Title"] = "Add Equipment";
    var equipmentType = ViewBag.EquipmentType as string;
    var showForm = !string.IsNullOrEmpty(equipmentType);
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-6">
            <i class="bi bi-plus-circle text-success"></i> @(showForm ? $"Add {equipmentType}" : "Add Equipment")
        </h1>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-x-circle"></i> Cancel
        </a>
    </div>

    @if (!showForm)
    {
        <!-- Equipment Type Selection -->
        <div class="row">
            <div class="col-md-8">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Select Equipment Type</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">Choose the type of equipment you want to add:</p>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="card h-100 border-info">
                                    <div class="card-body text-center">
                                        <i class="bi bi-funnel text-info display-1"></i>
                                        <h5 class="mt-3">Filter</h5>
                                        <p class="text-muted small">Mechanical, biological, or chemical filtration systems</p>
                                        <form asp-action="Create" method="post">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="equipmentType" value="Filter" />
                                            <input type="hidden" name="tankId" value="@ViewBag.SelectedTankId" />
                                            <button type="submit" class="btn btn-info">
                                                <i class="bi bi-plus"></i> Add Filter
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card h-100 border-danger">
                                    <div class="card-body text-center">
                                        <i class="bi bi-thermometer-high text-danger display-1"></i>
                                        <h5 class="mt-3">Heater</h5>
                                        <p class="text-muted small">Temperature control and regulation equipment</p>
                                        <form asp-action="Create" method="post">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="equipmentType" value="Heater" />
                                            <input type="hidden" name="tankId" value="@ViewBag.SelectedTankId" />
                                            <button type="submit" class="btn btn-danger">
                                                <i class="bi bi-plus"></i> Add Heater
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card h-100 border-warning">
                                    <div class="card-body text-center">
                                        <i class="bi bi-lightbulb text-warning display-1"></i>
                                        <h5 class="mt-3">Light</h5>
                                        <p class="text-muted small">LED, fluorescent, or other lighting systems</p>
                                        <form asp-action="Create" method="post">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="equipmentType" value="Light" />
                                            <input type="hidden" name="tankId" value="@ViewBag.SelectedTankId" />
                                            <button type="submit" class="btn btn-warning">
                                                <i class="bi bi-plus"></i> Add Light
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card h-100 border-primary">
                                    <div class="card-body text-center">
                                        <i class="bi bi-water text-primary display-1"></i>
                                        <h5 class="mt-3">Protein Skimmer</h5>
                                        <p class="text-muted small">Remove organic compounds from saltwater aquariums</p>
                                        <form asp-action="Create" method="post">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="equipmentType" value="ProteinSkimmer" />
                                            <input type="hidden" name="tankId" value="@ViewBag.SelectedTankId" />
                                            <button type="submit" class="btn btn-primary">
                                                <i class="bi bi-plus"></i> Add Skimmer
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm bg-light">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-info-circle"></i> Equipment Types
                    </div>
                    <div class="card-body">
                        <h6>Filter</h6>
                        <p class="small mb-3">Tracks filter type, flow rate, and maintenance schedules.</p>

                        <h6>Heater</h6>
                        <p class="small mb-3">Monitors wattage, target temperature, and performance.</p>

                        <h6>Light</h6>
                        <p class="small mb-3">Manages wattage, spectrum, and photoperiod settings.</p>

                        <h6>Protein Skimmer</h6>
                        <p class="small mb-0">Tracks maintenance and collection cup cleaning schedules.</p>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Equipment Details Form -->
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-pencil-square"></i> Equipment Details</h5>
            </div>
            <div class="card-body">
                <form asp-action="Create" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="equipmentType" value="@equipmentType" />
                    <input type="hidden" name="tankId" value="@ViewBag.SelectedTankId" />
                    
                    <div class="row g-3">
                        <!-- Tank Selection (if not preselected) -->
                        @{
                            int? selectedTankId = ViewBag.SelectedTankId as int?;
                        }
                        @if (selectedTankId == null || selectedTankId == 0)
                        {
                            <div class="col-md-12">
                                <label class="form-label fw-bold">Tank <span class="text-danger">*</span></label>
                                <select name="tankId" class="form-select" required>
                                    <option value="">-- Select Tank --</option>
                                    @if (ViewBag.Tanks != null)
                                    {
                                        @foreach (var tank in ViewBag.Tanks)
                                        {
                                            <option value="@tank.Value">@tank.Text</option>
                                        }
                                    }
                                </select>
                            </div>
                        }
                        else
                        {
                            <input type="hidden" name="tankId" value="@selectedTankId" />
                        }

                        <!-- Common Fields -->
                        <div class="col-md-6">
                            <label asp-for="Brand" class="form-label fw-bold">Brand <span class="text-danger">*</span></label>
                            <input asp-for="Brand" class="form-control" placeholder="e.g., Fluval, Eheim" required />
                            <span asp-validation-for="Brand" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="Model" class="form-label fw-bold">Model <span class="text-danger">*</span></label>
                            <input asp-for="Model" class="form-control" placeholder="e.g., FX6, 2217" required />
                            <span asp-validation-for="Model" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="InstalledOn" class="form-label fw-bold">Installation Date</label>
                            <input asp-for="InstalledOn" class="form-control" type="date" />
                            <span asp-validation-for="InstalledOn" class="text-danger small"></span>
                        </div>

                        <!-- Type-Specific Fields -->
                        @if (Model is AquaHub.MVC.Models.Filter)
                        {
                            var filter = Model as AquaHub.MVC.Models.Filter;
                            <div class="col-12"><hr class="my-3" /><h5 class="text-primary">Filter Details</h5></div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Filter Type</label>
                                <select name="Type" class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="0">Canister</option>
                                    <option value="1">HOB (Hang On Back)</option>
                                    <option value="2">Sump</option>
                                    <option value="3">Internal</option>
                                    <option value="4">Undergravel</option>
                                    <option value="5">Sponge</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Flow Rate (GPH)</label>
                                <input name="FlowRate" type="number" step="0.1" class="form-control" placeholder="e.g., 400" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Filter Media</label>
                                <input name="Media" type="text" class="form-control" placeholder="e.g., Ceramic rings, sponge" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Last Maintenance Date</label>
                                <input name="LastMaintenanceDate" type="date" class="form-control" />
                            </div>
                        }
                        else if (Model is AquaHub.MVC.Models.Heater)
                        {
                            <div class="col-12"><hr class="my-3" /><h5 class="text-primary">Heater Details</h5></div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Min Temperature (°F)</label>
                                <input name="MinTemperature" type="number" step="0.1" class="form-control" placeholder="e.g., 74" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Max Temperature (°F)</label>
                                <input name="MaxTemperature" type="number" step="0.1" class="form-control" placeholder="e.g., 82" />
                            </div>
                        }
                        else if (Model is AquaHub.MVC.Models.Light)
                        {
                            <div class="col-12"><hr class="my-3" /><h5 class="text-primary">Light Details</h5></div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Wattage</label>
                                <input name="Wattage" type="number" step="0.1" class="form-control" placeholder="e.g., 32" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Spectrum</label>
                                <input name="Spectrum" type="text" class="form-control" placeholder="e.g., Full Spectrum, RGB" />
                            </div>

                            <div class="col-md-6">
                                <div class="form-check mt-4">
                                    <input name="IsDimmable" type="checkbox" class="form-check-input" id="isDimmable" />
                                    <label class="form-check-label" for="isDimmable">Dimmable</label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Intensity (%)</label>
                                <input name="IntensityPercent" type="number" min="0" max="100" class="form-control" placeholder="e.g., 75" />
                            </div>

                            <div class="col-md-12">
                                <label class="form-label fw-bold">Schedule</label>
                                <input name="Schedule" type="text" class="form-control" placeholder="e.g., 8am-6pm" />
                            </div>
                        }
                        else if (Model is AquaHub.MVC.Models.ProteinSkimmer)
                        {
                            <div class="col-12"><hr class="my-3" /><h5 class="text-primary">Protein Skimmer Details</h5></div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Capacity (gallons)</label>
                                <input name="Capacity" type="number" step="0.1" class="form-control" placeholder="e.g., 150" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Type</label>
                                <input name="Type" type="text" class="form-control" placeholder="e.g., In-sump, HOB" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Air Intake</label>
                                <input name="AirIntake" type="number" class="form-control" placeholder="e.g., 400" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Cup Fill Level (%)</label>
                                <input name="CupFillLevel" type="number" min="0" max="100" class="form-control" placeholder="e.g., 50" />
                            </div>
                        }
                    </div>

                    <div class="d-flex gap-2 mt-4">
                        <button type="submit" class="btn btn-primary px-4">
                            <i class="bi bi-save"></i> Save Equipment
                        </button>
                        <a asp-action="Create" class="btn btn-outline-secondary px-4">
                            <i class="bi bi-arrow-left"></i> Back to Selection
                        </a>
                    </div>
                </form>
            </div>
        </div>
    }
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
