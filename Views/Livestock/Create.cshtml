@model AquaHub.MVC.Models.Livestock

@{
    ViewData["Title"] = "Add Livestock";
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        <i class="bi bi-plus-circle"></i> Add Livestock
                    </h3>
                </div>
                <div class="card-body p-4">
                    <form asp-action="Create" method="post">
                        <input type="hidden" name="tankId" value="@ViewBag.SelectedTankId" />
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label fw-bold">Tank <span class="text-danger">*</span></label>
                                <select name="tankId" id="tankSelect" class="form-select" required>
                                    @if (ViewBag.Tanks != null)
                                    {
                                        @foreach (var tank in ViewBag.Tanks)
                                        {
                                            <option value="@tank.Value"
                                                selected="@(tank.Value == ViewBag.SelectedTankId?.ToString())">@tank.Text
                                            </option>
                                        }
                                    }
                                </select>
                            </div>

                            <div class="col-12">
                                <label class="form-label fw-bold">Livestock Type <span
                                        class="text-danger">*</span></label>
                                <select name="livestockType" id="livestockType" class="form-select" required>
                                    <option value="">-- Select Type --</option>
                                    <option value="FreshwaterFish">Freshwater Fish</option>
                                    <option value="SaltwaterFish">Saltwater Fish</option>
                                    <option value="FreshwaterInvertebrate">Freshwater Invertebrate</option>
                                    <option value="SaltwaterInvertebrate">Saltwater Invertebrate</option>
                                    <option value="Coral">Coral</option>
                                    <option value="Plant">Plant</option>
                                </select>
                                <small class="form-text text-muted">Select the category of livestock you're
                                    adding</small>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Name" class="form-label fw-bold">Name <span
                                        class="text-danger">*</span></label>
                                <input asp-for="Name" class="form-control" placeholder="e.g., Nemo" required />
                                <span asp-validation-for="Name" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Species" class="form-label fw-bold">Species <span
                                        class="text-danger">*</span></label>
                                <input asp-for="Species" class="form-control" placeholder="e.g., Clownfish" required />
                                <span asp-validation-for="Species" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="AddedOn" class="form-label fw-bold">Date Added</label>
                                <input asp-for="AddedOn" class="form-control" type="date" />
                                <span asp-validation-for="AddedOn" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold">Purchase Price</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input name="purchasePrice" class="form-control" type="number" step="0.01"
                                        placeholder="0.00" />
                                </div>
                            </div>

                            <!-- Dynamic fields container -->
                            <div id="dynamicFields" class="col-12"></div>

                            <div class="col-md-12 mb-3">
                                <label asp-for="Notes" class="form-label fw-bold">Notes</label>
                                <textarea asp-for="Notes" class="form-control" rows="4"
                                    placeholder="Add any notes about care requirements, behavior, compatibility, etc."></textarea>
                                <span asp-validation-for="Notes" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="d-flex gap-2 mt-4">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="bi bi-save"></i> Save Livestock
                            </button>
                            <a asp-action="Index" class="btn btn-outline-secondary px-4">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const livestockType = document.getElementById('livestockType');
            const dynamicFields = document.getElementById('dynamicFields');

            livestockType.addEventListener('change', function () {
                const selectedType = this.value;
                dynamicFields.innerHTML = '';

                if (!selectedType) return;

                const fieldsHTML = getFieldsForType(selectedType);
                dynamicFields.innerHTML = fieldsHTML;
            });

            function getFieldsForType(type) {
                let html = '<div class="row g-3">';

                switch (type) {
                    case 'FreshwaterFish':
                    case 'SaltwaterFish':
                        html += `
                                    <div class="col-12"><h5 class="text-primary mt-3"><i class="bi bi-fish"></i> Fish Details</h5></div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Adult Size (inches)</label>
                                        <input name="adultSize" type="number" step="0.1" class="form-control" placeholder="e.g., 3.5" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Coloration</label>
                                        <input name="coloration" type="text" class="form-control" placeholder="e.g., Orange and white" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Temperament</label>
                                        <select name="temperament" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Peaceful">Peaceful</option>
                                            <option value="Semi-aggressive">Semi-aggressive</option>
                                            <option value="Aggressive">Aggressive</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Activity Level</label>
                                        <select name="activityLevel" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Low">Low</option>
                                            <option value="Moderate">Moderate</option>
                                            <option value="High">High</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Minimum Tank Size (gallons)</label>
                                        <input name="minTankSize" type="number" class="form-control" placeholder="e.g., 20" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Swimming Region</label>
                                        <select name="swimmingRegion" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Top">Top</option>
                                            <option value="Middle">Middle</option>
                                            <option value="Bottom">Bottom</option>
                                            <option value="All">All Levels</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check mt-4">
                                            <input name="isSchooling" type="checkbox" class="form-check-input" id="isSchooling" />
                                            <label class="form-check-label" for="isSchooling">Schooling Fish</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6" id="schoolSizeField" style="display: none;">
                                        <label class="form-label fw-bold">Recommended School Size</label>
                                        <input name="recommendedSchoolSize" type="number" class="form-control" placeholder="e.g., 6" />
                                    </div>
                                `;
                        if (type === 'SaltwaterFish') {
                            html += `
                                        <div class="col-md-6">
                                            <div class="form-check mt-2">
                                                <input name="isReefSafe" type="checkbox" class="form-check-input" id="isReefSafe" />
                                                <label class="form-check-label" for="isReefSafe">Reef Safe</label>
                                            </div>
                                        </div>
                                    `;
                        }
                        break;

                    case 'Coral':
                        html += `
                                    <div class="col-12"><h5 class="text-primary mt-3"><i class="bi bi-flower3"></i> Coral Details</h5></div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Colony Size (inches)</label>
                                        <input name="colonySize" type="number" step="0.1" class="form-control" placeholder="e.g., 2.5" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Coloration</label>
                                        <input name="coloration" type="text" class="form-control" placeholder="e.g., Green/Purple" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Lighting Needs</label>
                                        <select name="lightingNeeds" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Low">Low</option>
                                            <option value="Moderate">Moderate</option>
                                            <option value="High">High</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Flow Needs</label>
                                        <select name="flowNeeds" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Low">Low</option>
                                            <option value="Moderate">Moderate</option>
                                            <option value="High">High</option>
                                            <option value="Turbulent">Turbulent</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Placement</label>
                                        <select name="placement" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Bottom">Bottom</option>
                                            <option value="Middle">Middle</option>
                                            <option value="Top">Top</option>
                                            <option value="Sand bed">Sand Bed</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Growth Rate</label>
                                        <input name="growthRate" type="text" class="form-control" placeholder="e.g., Slow, 1 inch/year" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Care Level</label>
                                        <select name="careLevel" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Easy">Easy</option>
                                            <option value="Moderate">Moderate</option>
                                            <option value="Difficult">Difficult</option>
                                            <option value="Expert">Expert</option>
                                        </select>
                                    </div>
                                `;
                        break;

                    case 'Plant':
                        html += `
                                    <div class="col-12"><h5 class="text-primary mt-3"><i class="bi bi-flower1"></i> Plant Details</h5></div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Max Height (inches)</label>
                                        <input name="maxHeight" type="number" step="0.1" class="form-control" placeholder="e.g., 12" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Growth Rate</label>
                                        <select name="growthRate" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Slow">Slow</option>
                                            <option value="Moderate">Moderate</option>
                                            <option value="Fast">Fast</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Coloration</label>
                                        <input name="coloration" type="text" class="form-control" placeholder="e.g., Deep Green" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Placement</label>
                                        <select name="placement" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Foreground">Foreground</option>
                                            <option value="Midground">Midground</option>
                                            <option value="Background">Background</option>
                                            <option value="Floating">Floating</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Lighting Requirement</label>
                                        <select name="lightingRequirement" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Low">Low</option>
                                            <option value="Medium">Medium</option>
                                            <option value="High">High</option>
                                            <option value="Very High">Very High</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Care Level</label>
                                        <select name="careLevel" class="form-select">
                                            <option value="">-- Select --</option>
                                            <option value="Easy">Easy</option>
                                            <option value="Moderate">Moderate</option>
                                            <option value="Difficult">Difficult</option>
                                            <option value="Expert">Expert</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check mt-4">
                                            <input name="requiresCO2" type="checkbox" class="form-check-input" id="requiresCO2" />
                                            <label class="form-check-label" for="requiresCO2">Requires CO2</label>
                                        </div>
                                    </div>
                                `;
                        break;

                    case 'FreshwaterInvertebrate':
                    case 'SaltwaterInvertebrate':
                        html += `
                                    <div class="col-12"><h5 class="text-primary mt-3"><i class="bi bi-bug"></i> Invertebrate Details</h5></div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Adult Size (inches)</label>
                                        <input name="adultSize" type="number" step="0.1" class="form-control" placeholder="e.g., 2.0" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Coloration</label>
                                        <input name="coloration" type="text" class="form-control" placeholder="e.g., Red with white dots" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Behavior</label>
                                        <input name="behavior" type="text" class="form-control" placeholder="e.g., Peaceful, Nocturnal" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Minimum Tank Size (gallons)</label>
                                        <input name="minTankSize" type="number" class="form-control" placeholder="e.g., 10" />
                                    </div>
                                `;
                        if (type === 'FreshwaterInvertebrate') {
                            html += `
                                        <div class="col-md-6">
                                            <div class="form-check mt-2">
                                                <input name="isPlantSafe" type="checkbox" class="form-check-input" id="isPlantSafe" />
                                                <label class="form-check-label" for="isPlantSafe">Plant Safe</label>
                                            </div>
                                        </div>
                                    `;
                        }
                        if (type === 'SaltwaterInvertebrate') {
                            html += `
                                        <div class="col-md-6">
                                            <div class="form-check mt-2">
                                                <input name="isReefSafe" type="checkbox" class="form-check-input" id="isReefSafe" />
                                                <label class="form-check-label" for="isReefSafe">Reef Safe</label>
                                            </div>
                                        </div>
                                    `;
                        }
                        break;
                }

                html += '</div>';
                return html;
            }

            // Handle schooling checkbox
            document.addEventListener('change', function (e) {
                if (e.target.id === 'isSchooling') {
                    const schoolSizeField = document.getElementById('schoolSizeField');
                    if (schoolSizeField) {
                        schoolSizeField.style.display = e.target.checked ? 'block' : 'none';
                    }
                }
            });
        });
    </script>
}